---
title: "Airline Delay Prediction Report for American Airlines"
author: "Logistics Transport Aviation"
date: "03/10/2021"
output:
  word_document:
    toc: yes
    toc_depth: '3'
  pdf_document:
    toc: yes
    toc_depth: '3'
  html_document:
    toc: yes
    toc_float: yes
    toc_depth: 3
    fig_caption: yes
subtitle: STDS - AT2
---
  
```{r setup, include=FALSE}
## knitr::opts_chunk$set(echo = TRUE)
## install.packages("kableExtra")
library(tidyverse)
library(kableExtra)
```

## Introduction

Aircraft delays have serious economic impacts that represent a logistical headache for airlines, airports, airline crew, and passengers alike. In a 2010 study by the National Center of Excellence For Aviation Operations Research, an estimated 31.2 billion US dollars was lost due to direct and indirect costs of airline delays in the United States for 2007. These expenses included maintenance costs, extra paid hours for flight crew, the extra use of fuel, and airport fees. As an example, airlines have dedicated time slots at airport gates and unexpected delays exceeding the expected time slot can cost thousands of dollars by the minute.

Similar to other big US airlines such as Delta and United, American Airlines is presenting loses in the amount of billions of dollars per year since COVID impacted the world. 

(Include financial figures)

Many factors can contribute to aircraft delays. These may include unavoidable reasons such as inclement weather, unforeseen aircraft mechanical breakdowns, or a multitude of passenger-related incidents. Airline delays then create complicated scenarios for airline schedulers as a delay for one aircraft may impact the flight schedule for all consecutive flights using that aircraft. Passengers with connecting flights may need to be ticketed on other flights, reserve flight crew may need to be called if the current flight crew are going to exceed their flight hours, and delays may continue to have a snowball effect on later flights causing them to also be delayed (Ball, 2010).

Thus, understanding the impact of these variables on aircraft on-time performance can help elucidate ways and methods to mitigate these airline delays. By doing so, steps can be made to reduce airline costs associated with these delays, benefiting the airlines' stakeholders. We identify the primary stakeholders to be investors and shareholders for the financial performance of the airline. In addition, airline passengers are important stakeholders as delays negatively influence repurchase intentions and sentiment across word-of-mouth (Kim, 2016).

Herein, we propose an exploratory analysis and prediction model on airline delays utilizing data from the United States in 2019. For our analysis we are going to compare American Airlines to Delta and United Airlines, based on the fact that these 3 US airlines are market leaders in terms of Brand value, Market value and Domestic Market Share. We also took into consideration that these 3 airlines cater to the same segment of customers, that is the reason why big low-cost airlines such as Southwest were not considered for this analysis. 

## Problem at hand

During the last couple of years around 30% of the domestic flights in the United States have presented some sort of delay, this shows us the big opportunity we have in front of us. Specially if we take into consideration that every minute of delay costs airlines around $74 dollars, and that just during 2020 American Airlines domestic flights reported over 4 million minutes in delays just in domestic flights, meaning an approximate $300 million dollars were lost for this reason. 

(Include stack bar Domestic on time performance 3 airlines)

## Research Questions and EDA

## What are the main causes for Airline delays?

When looking at the main causes of delays for American Airlines flights between 2019 and 2021 we can see that the main reason corresponds to a Late arriving aircraft, meaning that a previous flight with same aircraft arrived late, causing the present flight to depart late.  This is followed closely by the second reason, an Air carrier delay, in this case a delay or cancellation can be attributed to circumstances within the airline's control such as maintenance or crew problems, aircraft cleaning, baggage loading, fueling, among others. National Aviation system delays, Weather and security issues have a lower impact on the total amount of delays. If we go back to the first reason, which can be explained by the following four, we can assume that most of those delays were caused due to circumstance within the airline’s control as well. Meaning most of the delays can be attributed to the airlines operations and therefore we have a great opportunity to reduce costs and improve our results. 

(Include graph reasons/delays in minutes)

## How is American Airlines on time performance compare to our two main competitors?

We found that all three airlines have improved their on-time performance considerably from 2019 to 2021. It is particularly interesting to us to see how United Airlines has improved their average delay time by almost 23% in just 2 years and how Delta has kept an steady leadership on Airtime performance. This once again shows us the great opportunity we have in our hands to not only improve our On-time performance, reduce costs and improve passengers’ satisfaction, but also to keep up with our main competitors and possibly beat them by learning from their good practices and most importantly taking a proactive approach to improve our current situation. 

(Include boxplot competitor performance)


## Linear Regression Model, Features and Limitations

## Limitations








Good features for the Introduction include:
• Summary of the study and data, as well as any relevant substantive context, background, or
framing issues.
• The “big questions” answered by your data analyses, and summaries of your conclusions about
these questions.
• Brief outline of remainder of paper.
The above is a pretty good order to present this material in as well.


## Body

```{r stakeholder_analysis, echo=FALSE}
text_tbl <- data.frame(
  Stakeholders = c("Airline company executives", "Airline company employees", "Shareholders and investors of Airline companies", "Consumers of airline companies", "Suppliers for Airline companies", "Government"),
  Description = c(
    "The main participants in the aviation industry. 
This project can help them improve their operational planning and execution and any related products and services. ",
    "Pilots, engineers, and flight attendants ensure that passengers' needs are appropriately met and satisfied.  ", 
    "Their primary role is to provide capital in the form of share capital. Airlines performance may affect their investing behaviours. ", "Airline company/industry’s primary revenue source. Customers are the most important factor in this industry; without customers, airlines would not exist. ", "Form in which how much the company orders supplies in impacts inventory, e.g Aircraft manufacters, fuel and food/beverage resources. ", "Government and policy makers can impact how the industry will be regulated, such as climate change, tourism, and infrastructure policy.  "
  )
)

kbl(text_tbl) %>%
  kable_paper(full_width = F) %>%
  column_spec(1, bold = T, border_right = T) %>%
  column_spec(2, width = "30em")
```

The body can be organized in several ways. Here are two that often work well:
• Traditional. Divide the body up into several sections at the same level as the Introduction, with
names like:
– Data
– Methods
– Analysis
– Results
This format is very familiar to those who have written psych research papers. It often works
well for a data analysis paper as well, though one problem with it is that the Methods section
often sounds like a bit of a stretch: In a psych research paper the Methods section describes
what you did to get your data. In a data analysis paper, you should describe the analyses that
you performed. Without the results as well, this can be pretty sterile sounding, so I often merge
these “methods” pieces into the “Analysis” section when I write.
• Question-oriented. In this format there is a single Body section, usually called “Analysis”,
and then there is a subsection for each question raised in the introduction, usually taken in the
same order as in the introduction (general to specific, decreasing order of importance, etc.).
Within each subsection, statistical method, analyses, and conclusion would be described (for
each question). For example:
2. Analysis
2.1 Success Rate
Methods
Analysis
Conclusions
2.2 Time to Relapse
Methods
Analysis
Conclusions
3
2.3 Effect of Gender
Methods
Analysis
Conclusions
2.4 Hospital Effects
Methods
Analysis
Conclusions
Etc. . .
Other organizational formats are possible too. Whatever the format, it is useful to provide one or two
well-chosen tables or graphs per question in the body of the report, for two reasons: First, graphical
and tabular displays can convey your points more efficiently than words; and second, your “skimming”
audiences will be more likely to have their eye caught by an interesting graph or table than by running
text. However, too much graphical/tabular material will break up the flow of the text and become
distracting; so extras should be moved to the Appendix.


## Conclusion

As the airline network contains complex interactions between regulatory, passenger, and airline-specific needs, predicting delays and understanding the primary causes is relatably complicated. 

Our main question to answer is: **Which factors are most correlated to, and influence greatly, on-time aircraft performance?**. 

From here, smaller questions can be asked such as: Are delays impacted by weather, date, time of day, route, aircraft type, or economic category?

The conclusion should reprise the questions and conclusions of the introduction, perhaps augmented by some additional observations or details gleaned from the analysis
section. New questions, future work, etc., can also be raised here.


## References

Ball, M. (2010, November). Total Delay Impact Study A Comprehensive Assessment of the Costs and Impacts of Flight Delay in the United States. https://isr.umd.edu/NEXTOR/pubs/TDI_Report_Final_11_03_10.pdf

Kim, N. Y., & Park, J. W. (2016). A study on the impact of airline service delays on emotional reactions and customer behavior. Journal of Air Transport Management, 57, 19–25. https://doi.org/10.1016/j.jairtraman.2016.07.005


## Appendix

```{r add_packages, message=FALSE, warning=FALSE}
  library(psych)
  library(devtools)

  library(tidyverse)
  library(dplyr)
  library(ggplot2)
  library(Amelia)

  library(knitr)
  
```


To get the latest content, we are using a web API call for Airport Names. The `httr::get` will assist us in fetching the content in the JSON format. API key is being used for authenticating our call with the API provider. Since JSON cannot be directly consumed by regression packages, we deploy `jsonlite::fromJSON` to convert to an R dataframe.

```{r, message=FALSE, warning=FALSE}
library(httr)
library(jsonlite)
library(dplyr)

icao <- GET(
  url = 'https://applications.icao.int/dataservices/api/safety-characteristics-list?api_key=8d00ef90-0982-11ec-9d72-8160549d64ab&airports=&states=USA'
)
response <- content(icao, 'parsed')
API_data <- fromJSON(response)

#Only pick those columns that are useful later on 
API_data <- API_data %>% select(airportCode, airportName)
```

Scrapping AIrfleet data from web 
```{r, eval = FALSE}
# Explicit URL
url <- 'https://www.planemapper.com/airlines/AAL'

AA <- url %>% 
  read_html() %>% 
  html_nodes(xpath='//*[@id="aircrafts"]') %>% 
  html_table()

AA_fleet <- AA[[1]]

View(AA_fleet)

# Write AA_fleet to feather
write_feather(AA_fleet, here('AA_fleet.feather'))

# Explicit URL
swaurl <- 'https://www.planemapper.com/airlines/SWA'

SWA <- swaurl %>% 
  read_html() %>% 
  html_nodes(xpath='//*[@id="aircrafts"]') %>% 
  html_table()

SWA_fleet <- SWA[[1]]

View(SWA_fleet)

# Write AA_fleet to feather
write_feather(SWA_fleet, here('SWA_fleet.feather'))

# Explicit URL
jbuurl <- 'https://www.planemapper.com/airlines/JBU'

JBU <- jbuurl %>% 
  read_html() %>% 
  html_nodes(xpath='//*[@id="aircrafts"]') %>% 
  html_table()

JBU_fleet <- JBU[[1]]

# Write AA_fleet to feather
write_feather(JBU_fleet, here('JBU_fleet.feather'))

# Explicit URL
dalurl <- 'https://www.planemapper.com/airlines/DAL'

DAL <- dalurl %>% 
  read_html() %>% 
  html_nodes(xpath='//*[@id="aircrafts"]') %>% 
  html_table()

DAL_fleet <- DAL[[1]]

# Write AA_fleet to feather
write_feather(DAL_fleet, here('DAL_fleet.feather'))

ualurl <- 'https://www.planemapper.com/airlines/UAL'

UAL <- ualurl %>% 
  read_html() %>% 
  html_nodes(xpath='//*[@id="aircrafts"]') %>% 
  html_table()

UAL_fleet <- UAL[[1]]

# Write AA_fleet to feather
write_feather(UAL_fleet, here('UAL_fleet.feather'))
```

Merging Airfleet data into our dataset

```{r, eval = FALSE}
# Load Files ----
maindf <- read_feather(here('clean_3airlines.feather'))

delta <- read_feather(here('DAL_fleet.feather'))

american <- read_feather(here('AA_fleet.feather'))

united <- read_feather(here('UAL_fleet.feather'))

# Join Files ----

allrows <- bind_rows(delta, american, united)

testjoin <- left_join(maindf, allrows, by = c('tail_num' = 'Tail'))

col_status <- status(testjoin)

# Clean column names ----
clean_join <- clean_names(testjoin)

# Separate the age/year columns into two columns
separate <- clean_join %>% 
  separate(age_built, c('age', 'year'))

status(separate)
```

Airline On-time data 
```{r, eval = FALSE}
ontime_raw <- read.csv("https://raw.githubusercontent.com/charlottetse33/36103_Logistics-Transport-Aviation/main/test%20on%20time%20report.csv")
```
Airline DOT_ID corresponding to Airline Names
```{r, eval = FALSE}
#Seperate loading data to prevent R from crashing
id_airline <- read.csv("https://raw.githubusercontent.com/charlottetse33/36103_Logistics-Transport-Aviation/main/dot_id_airline.csv")

```
Merge Airline Names with On-time Dataset 
```{r, eval = FALSE}
colnames(id_airline) <- c("DOT_ID_Reporting_Airline", "Airline")
  
ontime_1 <- left_join(ontime_raw, id_airline, by = "DOT_ID_Reporting_Airline")

```
Merge API Airport names with On-time Dataset 
```{r, eval = FALSE}
ontime_2 <- ontime_1 %>% mutate(Origin_airportCode = paste("K",Origin, sep = ""), Dest_airportCode = paste("K",Dest, sep = ""))

Originjoint <- left_join(ontime_2, API_data, by = c("Origin_airportCode" = "airportCode"))
names(Originjoint)[names(Originjoint) == "airportName"] <- "Origin_airportName"

ontime_final <- left_join(Originjoint, API_data, by = c("Dest_airportCode" = "airportCode"))
names(ontime_final)[names(ontime_final) == "airportName"] <- "Dest_airportName"

#New column names from merging data: 
#Airline, Origin_airportName, Dest_airportName

```
Adding fleet data into ontime dataset 
```{r, eval = FALSE}
maindf <- read_feather(here('clean_3airlines.feather'))

delta <- read_feather(here('DAL_fleet.feather'))

american <- read_feather(here('AA_fleet.feather'))

united <- read_feather(here('UAL_fleet.feather'))

# Join Files ----

allrows <- bind_rows(delta, american, united)

testjoin <- left_join(maindf, allrows, by = c('tail_num' = 'Tail'))

col_status <- status(testjoin)

# Clean column names ----
clean_join <- clean_names(testjoin)

# Separate the age/year columns into two columns
separate <- clean_join %>% 
  separate(age_built, c('age', 'model_year'))

status(separate)

# Save a feather file

write_feather(separate, here('clean_3airline_fleet.feather'))

```

Adding employee data into ontime dataset
```{r, eval = FALSE}
allmonths <- read_feather("C:/Users/tsetc/Downloads/clean_3airline_fleet (1).feather")
#This dataset includes airline, origin_airportname, dest_airportname 

names(allmonths) <- toupper(names(allmonths))

# read employee dataset 
employee_data <- read_csv("https://raw.githubusercontent.com/timothywallaby/36103_Logistics-Transport-Aviation/main/Employment%20dataset%202019-2021.csv")

# concentenate variables for employee dataset 
employee_data$combine <- paste(employee_data$YEAR, employee_data$MONTH, employee_data$CARRIER_NAME, sep = "_")
employee_data <- employee_data %>% select(combine, EMPFULL, EMPPART, EMPTOTAL, EMPFTE)

# concentenate variables for big dataset
allmonths$combine <- paste(allmonths$YEAR, allmonths$MONTH, allmonths$AIRLINE, sep = "_")

# Combine 2 dataset 
allmonths <- left_join(allmonths, employee_data, by = 'combine')

allmonths <- allmonths %>% select(-combine)

write_feather(allmonths, "C:/Users/tsetc/Downloads/clean_3airline_fleet_employ.feather")
```
Clean data 



One or more appendices are the place to out details and ancillary materials.
These might include such items as
• Technical descriptions of (unusual) statistical procedures
• Detailed tables or computer output
• Figures that were not central to the arguments presented in the body of the report
• Computer code used to obtain results.
In all cases, and especially in the case of computer code, it is a good idea to add some text sentences
as comments or annotations, to make it easier for the uninitiated reader to follow what you are doing.
It is often difficult to find the right balance between what to put in the appendix and what to put in
the body of the paper. Generally you should put just enough in the body to make the point, and refer
the reader to specific sections or page numbers in the appendix for additional graphs, tables and other
details.